<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tech Stack & Education â€¢ Abhishek Singh</title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://unpkg.com/d3-milestones/build/d3-milestones.css">
<script src="https://unpkg.com/d3-milestones/build/d3-milestones.min.js"></script>
<style>
body, html { margin:0; padding:0; font-family:sans-serif; background:#f5f5f5; }
.card { background:white; border-radius:16px; box-shadow:0 4px 20px rgba(0,0,0,0.08); padding:20px; width:100%; max-width:1200px; margin:20px auto; }
#tech-tree { width:100%; height:500px; }
.link { fill:none; stroke:#ccc; stroke-width:2px; }
.node circle { fill:#fff; stroke:#333; stroke-width:1.4px; cursor:pointer; }
.node text { font-size:12px; user-select:none; }
</style>
</head>
<body class="flex flex-col items-center gap-10 p-6">

<div class="card">
  <h1 class="text-2xl md:text-3xl font-bold text-center mb-6">Familiar Technology Stacks</h1>
  <svg id="tech-tree"></svg>
</div>

<div class="card">
  <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">Education</h2>
  <div class="timeline-wrapper">
    <div id="education-timeline"></div>
  </div>
</div>

<script>
const data = {
  name: "Tech Stack",
  children: [
    { name: "Frontend", children: [{name:"HTML"},{name:"CSS"},{name:"JavaScript"},{name:"React"}] },
    { name: "Backend", children: [{name:"Node.js"},{name:"Python"},{name:"Flask"}] },
    { name: "Database", children: [{name:"PostgreSQL"},{name:"MongoDB"}] }
  ]
};

const svg = d3.select("#tech-tree");
const width = +svg.node().clientWidth;
const height = +svg.node().clientHeight;
const g = svg.append("g").attr("transform","translate(40,40)");

const treeLayout = d3.tree().size([width-80,height-80]);
const root = d3.hierarchy(data);
root.x0 = height/2;
root.y0 = 0;

// Collapse all except root children
root.children.forEach(collapse);

function collapse(d){
  if(d.children){
    d._children = d.children;
    d._children.forEach(collapse);
    d.children = null;
  }
}

function update(source){
  const treeData = treeLayout(root);
  const nodes = treeData.descendants();
  const links = treeData.links();

  nodes.forEach(d=>d.y = d.depth*140);

  const node = g.selectAll("g.node").data(nodes, d=>d.id || (d.id=d3.randomUUID()));
  const nodeEnter = node.enter().append("g")
    .attr("class","node")
    .attr("transform",_=>`translate(${source.y0},${source.x0})`)
    .on("click",(_,d)=>{ click(d); update(d); });

  nodeEnter.append("circle").attr("r",0).transition().duration(300).attr("r",8);
  nodeEnter.append("text").attr("dy","0.32em").attr("x", d=> d._children || d.children ? 12 : 8)
    .text(d=>d.data.name).style("fill-opacity",0).transition().duration(300).style("fill-opacity",1);

  const nodeUpdate = nodeEnter.merge(node).transition().duration(300)
    .attr("transform", d=>`translate(${d.y},${d.x})`);

  nodeUpdate.select("circle").attr("r",8);
  nodeUpdate.select("text").style("fill-opacity",1);

  const nodeExit = node.exit().transition().duration(300)
    .attr("transform",_=>`translate(${source.y},${source.x})`).remove();
  nodeExit.select("circle").attr("r",0);
  nodeExit.select("text").style("fill-opacity",0);

  const link = g.selectAll("path.link").data(links, d=>d.target.id);
  const diagonal = d3.linkHorizontal().x(d=>d.y).y(d=>d.x);

  link.enter().append("path").attr("class","link").attr("d",_=>{ const o={x:source.x0,y:source.y0}; return diagonal({source:o,target:o}); })
    .merge(link).transition().duration(300).attr("d",diagonal);
  link.exit().transition().duration(300).attr("d",_=>{ const o={x:source.x,y:source.y}; return diagonal({source:o,target:o}); }).remove();

  nodes.forEach(d=>{ d.x0=d.x; d.y0=d.y; });
}

function click(d){
  if(d.children){ d._children=d.children; d.children=null; }
  else{ d.children=d._children; d._children=null; }
}

update(root);

// Education Timeline
fetch("data/education.json").then(res=>res.json()).then(eduMilestones=>{
  const chart = milestones('#education-timeline')
    .mapping({ timestamp:'year', text:'title' })
    .parseTime('%Y')
    .aggregateBy('year')
    .orientation('horizontal')
    .distribution('top-bottom')
    .autoResize(true)
    .optimize(true)
    .render(eduMilestones);

  chart.svg.selectAll('.milestones-item text').each(function(d,i){
    const el = d3.select(this);
    el.text("");
    el.append('tspan').attr('class','milestone-title').attr('x',0).attr('dy',0).text(eduMilestones[i].title);
    el.append('tspan').attr('class','milestone-detail').attr('x',0).attr('dy','1.2em').text(eduMilestones[i].detail);
    if(eduMilestones[i].icon){
      chart.svg.append("image").attr("xlink:href",eduMilestones[i].icon).attr("width",24).attr("height",24)
        .attr("x", d.x ? d.x-12:0).attr("y", d.y ? d.y-40:0);
    }
  });
});
</script>
</body>
</html>