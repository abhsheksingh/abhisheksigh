<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tech Stack & Education â€¢ Abhishek Singh</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/d3-milestones/build/d3-milestones.css">
  <script src="https://unpkg.com/d3-milestones/build/d3-milestones.min.js"></script>

  <style>
    /* Buttons & D3 styling */
    .dtv-btn {
      display: inline-flex; align-items: center; gap: 10px;
      padding: 10px 16px; border-radius: 9999px; border: 1px solid #e2e2e2;
      background: linear-gradient(180deg, #ffffff, #f3f3f3);
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      color: #333; font-size: 14px; font-weight: 600; cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease, background 0.15s ease;
      user-select: none;
    }
    .dtv-btn:hover { transform: translateY(-1px); background: linear-gradient(180deg,#fff,#ececec); border-color:#cfcfcf; box-shadow:0 6px 14px rgba(0,0,0,0.12); }
    .dtv-btn.active { border-color:#00897b; box-shadow:0 6px 16px rgba(0,137,123,0.18); background:linear-gradient(180deg,#fff,#ededed); }
    .dtv-btn .num { width:24px;height:24px;display:inline-flex;align-items:center;justify-content:center;border-radius:9999px;font-weight:700;font-size:13px;color:#fff;background:linear-gradient(145deg,#4db6ac,#00897b); }

    .link { fill: none; stroke: #ccc; stroke-width: 2px; }
    .hexagon { fill: #eee; stroke: #999; stroke-width: 2px; }
    .node text { fill: #333; }

    /* Education timeline tweaks */
    #education-timeline { width: 100%; height: 350px; max-width: 1000px; margin: auto; }
    #education-timeline svg { width: 100% !important; height: auto !important; overflow: visible !important; padding-right: 80px; }
    .timeline-wrapper { width: 100%; overflow-x: auto; }
    .milestone-title { font-weight: bold; font-size: 14px; }
    .milestone-detail { font-size: 12px; fill: #555; }

    /* Responsive height adjustments for the Tech Stack graph */
    @media (max-width: 640px) {
      #tech-graph-container {
        padding-bottom: 120% !important; /* taller height for iPhones */
      }
    }
    @media (min-width: 641px) and (max-width: 1024px) {
      #tech-graph-container {
        padding-bottom: 90% !important; /* medium screens */
      }
    }
    @media (min-width: 1025px) {
      #tech-graph-container {
        padding-bottom: 70% !important; /* default for desktops */
      }
    }
  </style>
</head>
<body class="bg-gray-50 flex flex-col items-center min-h-screen gap-10 p-6">

  <!-- Tech Stack Card -->
  <div class="bg-white rounded-2xl shadow-lg p-6 md:p-10 w-full max-w-6xl">
    <h1 class="text-2xl md:text-3xl font-bold text-center mb-6">Familiar Technology Stacks</h1>
    <div id="buttons" class="flex flex-wrap justify-center gap-3 mb-6"></div>
    <!-- Responsive container with ID -->
    <div id="tech-graph-container" class="relative w-full pb-[70%]">
      <svg class="absolute inset-0 w-full h-full"></svg>
    </div>
  </div>

  <!-- Education Card -->
  <div class="bg-white rounded-2xl shadow-lg p-6 md:p-10 w-full max-w-6xl">
    <h2 class="text-2xl md:text-3xl font-bold text-center mb-6">Education</h2>
    <div class="timeline-wrapper">
      <div id="education-timeline"></div>
    </div>
  </div>

  <script>
    // === Tech Stack D3 ===
    let categories = [];
    let currentCategory = null;

    function hexagon(r){ 
      let angle=Math.PI/3; 
      return d3.range(6).map(i=>[r*Math.cos(angle*i), r*Math.sin(angle*i)]).join("L")+"Z"; 
    }

    function setActiveButton(categoryName){ 
      document.querySelectorAll('.dtv-btn').forEach(btn=>{
        btn.classList.toggle('active', btn.getAttribute('data-category')===categoryName);
      }); 
    }

    function drawTree(categoryName){
      currentCategory = categoryName;
      setActiveButton(categoryName);

      const container = document.querySelector('#tech-graph-container');
      const width = container.clientWidth;
      const height = container.clientHeight;

      const svg = d3.select("svg");
      svg.selectAll("*").remove();

      const g = svg.append("g").attr("transform", `translate(0,50)`);

      const category = categories.find(c=>c.category===categoryName);
      const data = {name: category.category, children: category.technologies};
      const root = d3.hierarchy(data);

      const treeLayout = d3.tree().size([width, height-100]);
      treeLayout(root);

      const nodeRadius = width<640?20:30;
      const iconSize = width<640?20:30;
      const labelFont = width<640?"10px":"12px";
      const labelOffset = width<640?nodeRadius+12:nodeRadius+15;

      g.selectAll(".link").data(root.links()).enter().append("path")
        .attr("class","link")
        .attr("d", d3.linkVertical().x(d=>d.x).y(d=>d.y+15));

      const node = g.selectAll(".node").data(root.descendants()).enter()
        .append("g").attr("class","node").attr("transform", d=>`translate(${d.x},${d.y})`);

      node.filter(d=>d.depth===0).append("path").attr("d",hexagon(50)).attr("class","hexagon");
      node.filter(d=>d.depth===0).append("text").attr("text-anchor","middle").attr("dy",5).text(d=>d.data.name);

      // Node group for circle + icon
      const nodeGroup = node.filter(d=>d.depth>0)
        .append("g")
        .attr("class","group")
        .style("cursor", "pointer");

      // Circle
      nodeGroup.append("circle")
        .attr("r", nodeRadius)
        .attr("fill", "#ffffff")
        .attr("stroke", "#ccc")
        .attr("stroke-width", 2);

      // Icon
      nodeGroup.filter(d=>d.data.icon).append("image")
        .attr("xlink:href", d=>d.data.icon)
        .attr("x",-iconSize/2)
        .attr("y",-iconSize/2)
        .attr("width", iconSize)
        .attr("height", iconSize)
        .on("click",(event,d)=>{ if(d.data.link) window.open(d.data.link,"_blank"); });

      // Hover effect
      nodeGroup.on("mouseover", function() {
          d3.select(this).select("circle").attr("stroke", "#000");
      })
      .on("mouseout", function() {
          d3.select(this).select("circle").attr("stroke", "#ccc");
      });

      nodeGroup.append("text")
        .attr("dy",labelOffset)
        .attr("text-anchor","middle")
        .style("font-size",labelFont)
        .text(d=>d.data.name);
    }

    fetch("data/categories.json").then(res=>res.json()).then(data=>{
      categories = data;
      const buttonContainer = document.getElementById("buttons");
      categories.forEach((cat,idx)=>{
        const btn = document.createElement("button");
        btn.className="dtv-btn";
        btn.setAttribute("data-category",cat.category);
        btn.innerHTML=`<span class="num">${idx+1}</span>${cat.category}`;
        btn.onclick=()=>drawTree(cat.category);
        buttonContainer.appendChild(btn);
      });
      drawTree(categories[0].category);
      window.addEventListener("resize",()=>drawTree(currentCategory));
    });

    // === Education Timeline ===
    fetch("data/education.json")
      .then(res => res.json())
      .then(eduMilestones => {
        const chart = milestones('#education-timeline')
          .mapping({ timestamp: 'year', text: 'title' })
          .parseTime('%Y')
          .aggregateBy('year')
          .orientation('horizontal')
          .distribution('top-bottom')
          .autoResize(true)
          .optimize(true)
          .render(eduMilestones);

        chart.svg.selectAll('.milestones-item text').each(function(d, i){
          const el = d3.select(this);
          el.text("");

          el.append('tspan')
            .attr('class','milestone-title')
            .attr('x', 0)
            .attr('dy', 0)
            .text(eduMilestones[i].title);

          el.append('tspan')
            .attr('class','milestone-detail')
            .attr('x', 0)
            .attr('dy', '1.2em')
            .text(eduMilestones[i].detail);

          if (eduMilestones[i].icon) {
            chart.svg.append("image")
              .attr("xlink:href", eduMilestones[i].icon)
              .attr("width", 24)
              .attr("height", 24)
              .attr("x", d.x ? d.x - 12 : 0)
              .attr("y", d.y ? d.y - 40 : 0);
          }
        });
      });
  </script>
</body>
</html>
