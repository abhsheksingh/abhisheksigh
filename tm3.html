<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Abhishek Singh - Portfolio Tree</title>
<style>
  body {
    margin: 0; font-family: sans-serif; color: #333;
    display: flex; flex-direction: column; height: 100vh;
    background-color: #f9f9f9;
    background-image: radial-gradient(#ddd 1px, transparent 1px);
    background-size: 20px 20px;
  }
  header {
    text-align: center; padding: 1rem;
    border-bottom: 1px dashed #ccc; background: rgba(255,255,255,0.9);
    position: sticky; top: 0; z-index: 10;
    backdrop-filter: blur(4px);
  }
  main {
    flex: 1; display: flex; overflow: hidden;
  }
  #tree-container {
    flex: 2; display: flex; justify-content: center; align-items: center;
    overflow: hidden;
  }
  svg { width: 100%; height: 100%; }
  #detail-panel {
    flex: 1; max-width: 350px;
    border-left: 1px solid #ddd;
    background: rgba(255,255,255,0.9);
    padding: 1rem; overflow-y: auto;
    box-shadow: -2px 0 5px rgba(0,0,0,0.05);
    backdrop-filter: blur(4px);
    transition: transform 0.3s ease-in-out;
  }
  #detail-panel.hidden { transform: translateX(100%); }
  .panel-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
  .panel-content { font-size: 14px; line-height: 1.5; }
  .link { fill: none; stroke: #bbb; stroke-width: 1.5px; stroke-dasharray: 3 3; }
  .node circle { fill: #fff; stroke: #333; stroke-width: 1.5px; }
  .node--collapsed circle { stroke-dasharray: 4 2; }
  .node--expanded circle { stroke-dasharray: none; }
  .node text { font-size: 13px; user-select: none; }
  .root-label { font-size: 14px; font-weight: bold; fill: #0077ff; }
  .node image { pointer-events: none; }
  @media (max-width: 768px) {
    main { flex-direction: column; }
    #detail-panel { max-width: none; border-left: none; border-top: 1px solid #ddd; transform: translateY(100%); }
    #detail-panel.hidden { transform: translateY(100%); }
    #detail-panel.visible { transform: translateY(0); }
  }
</style>
</head>
<body>
<header><h1>Portfolio Tree</h1></header>
<main>
  <div id="tree-container"><svg id="tree"></svg></div>
  <aside id="detail-panel" class="hidden">
    <div class="panel-title">Select a section</div>
    <div class="panel-content">Click on a node to see more details here.</div>
  </aside>
</main>

<script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
<script>
// --- DATA ---
const data = {
  name: "Abhishek Singh",
  photo: "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&h=200&q=80",
  blurb: "Welcome to my portfolio! Explore my skills, education, experience, and digital credentials.",
  icon: "icons/profile.png",
  children: [
    {
      name: "Skills",
      blurb: "My technical skills.",
      icon: "icons/skills2.svg",
      children: [
        { name: "Programming", icon: "icons/programming.svg", children: [
            { name: "Python", icon: "icons/python.svg", link: "https://www.python.org/" },
            { name: "R", icon: "icons/r.svg", link: "https://www.r-project.org/" },
            { name: "JavaScript", icon: "icons/javascript.svg", link: "https://developer.mozilla.org/en-US/docs/Web/JavaScript" }
          ]
        },
        { name: "Visualization", icon: "icons/visualization.svg", children: [
            { name: "Looker", icon: "icons/looker.svg", link: "https://looker.com/" },
            { name: "PowerBI", icon: "icons/powerbi.svg", link: "https://powerbi.microsoft.com/" }
          ]
        }
      ]
    },
    { name: "Education", blurb: "My academic background.", icon: "icons/education.svg", children: [
        { year: 2011, name: "B.Sc - University of Delhi", detail: "Life Sciences – First Division", icon: "icons/bachelor.svg" },
        { year: 2015, name: "M.Sc - Central University of Punjab", detail: "Human Genetics – First Class Distinction", icon: "icons/college.png" }
      ]
    }
  ]
};

// --- D3 TREE ---
const svg = d3.select("#tree"),
      g = svg.append("g").attr("transform", "translate(40,40)");

let width = svg.node().clientWidth,
    height = svg.node().clientHeight;
let i = 0, duration = 400;

const treeLayout = d3.tree().size([width - 100, height - 120]);

let root = d3.hierarchy(data, d => d.children);
root.x0 = width/2; root.y0 = 0;
root.children.forEach(collapse);

// Collapse function (skip root)
function collapse(d) {
  if(d.depth === 0) return;
  if(d.children) {
    d._children = d.children;
    d._children.forEach(collapse);
    d.children = null;
  }
}

// Show detail panel
function showDetails(d) {
  const panel = document.getElementById("detail-panel");
  panel.querySelector(".panel-title").textContent = d.data.name || d.data.year;
  panel.querySelector(".panel-content").textContent = d.data.blurb || d.data.detail || "No details available.";
  panel.classList.remove("hidden");
  panel.classList.add("visible");
}

// Wrap long text
function wrapText(text, width) {
  text.each(function() {
    const textEl = d3.select(this),
          words = textEl.text().split(/\s+/).reverse();
    let word, line=[], lineNumber=0, lineHeight=1.1,
        y = textEl.attr("y"), dy=0,
        tspan = textEl.text(null).append("tspan").attr("x",0).attr("y",y).attr("dy",dy+"em");
    while(word = words.pop()){
      line.push(word);
      tspan.text(line.join(" "));
      if(tspan.node().getComputedTextLength() > width){
        line.pop();
        tspan.text(line.join(" "));
        line = [word];
        tspan = textEl.append("tspan").attr("x",0).attr("y",y).attr("dy",++lineNumber*lineHeight+dy+"em").text(word);
      }
    }
  });
}

// Update tree
function update(source) {
  treeLayout(root);
  const nodes = root.descendants();
  const links = root.links();
  nodes.forEach(d => d.y = d.depth*120);

  let node = g.selectAll("g.node").data(nodes, d => d.id || (d.id=++i));

  const nodeEnter = node.enter().append("g")
    .attr("class", d=>d.depth===0?"node root-node":(d._children?"node node--collapsed":"node node--expanded"))
    .attr("transform", d=>`translate(${source.x0},${source.y0})`)
    .on("click", (_,d)=>{
      if(d.data.link) window.open(d.data.link, "_blank");
      if(d.depth!==0){
        if(d.children){ d._children=d.children; d.children=null; }
        else { d.children=d._children; d._children=null; }
      }
      update(d); showDetails(d);
    });

  nodeEnter.filter(d=>d.depth!==0).append("circle").attr("r",1e-6);

  nodeEnter.filter(d=>d.data.icon).append("image")
    .attr("xlink:href", d=>d.data.icon).attr("x",-12).attr("y",-12).attr("width",24).attr("height",24);

  nodeEnter.filter(d=>d.depth===0).append("image")
    .attr("xlink:href", d=>d.data.photo).attr("x",-25).attr("y",-25).attr("width",50).attr("height",50)
    .style("clip-path","circle(25px at center)");

  nodeEnter.append("text")
    .attr("dy", d=>d.depth===0?40:-24)
    .attr("text-anchor","middle")
    .attr("class", d=>d.depth===0?"root-label":"")
    .text(d=>d.data.name || d.data.year)
    .call(wrapText, 80)
    .style("fill-opacity",1e-6);

  const nodeUpdate = nodeEnter.merge(node);
  nodeUpdate.transition().duration(duration).attr("transform", d=>`translate(${d.x},${d.y})`);
  nodeUpdate.select("circle").attr("r",18);
  nodeUpdate.select("text").style("fill-opacity",1);
  nodeUpdate.attr("class", d=>d.depth===0?"node root-node":(d._children?"node node--collapsed":"node node--expanded"));

  const nodeExit = node.exit().transition().duration(duration)
    .attr("transform", d=>`translate(${source.x},${source.y})`).remove();
  nodeExit.select("circle").attr("r",1e-6);
  nodeExit.select("text").style("fill-opacity",1e-6);

  let link = g.selectAll("path.link").data(links, d=>d.target.id);
  const linkEnter = link.enter().insert("path","g").attr("class","link").attr("d", d=>{
    let o={x:source.x0, y:source.y0};
    return d3.linkVertical().x(d=>d.x).y(d=>d.y)({source:o,target:o});
  });

  link.merge(linkEnter).transition().duration(duration).attr("d", d3.linkVertical().x(d=>d.x).y(d=>d.y));
  link.exit().transition().duration(duration).attr("d", d=>{
    let o={x:source.x,y:source.y};
    return d3.linkVertical().x(d=>d.x).y(d=>d.y)({source:o,target:o});
  }).remove();

  nodes.forEach(d=>{d.x0=d.x; d.y0=d.y;});
}

// Resize handling
function resize(){
  width = svg.node().clientWidth; height = svg.node().clientHeight;
  treeLayout.size([width-100,height-120]);
  svg.attr("viewBox", `0 0 ${width} ${height}`).attr("preserveAspectRatio", "xMidYMid meet");
  update(root);
}
window.addEventListener("resize", resize);

update(root);
</script>
</body>
</html>
